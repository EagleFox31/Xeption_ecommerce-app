# Xeption Network Backend - Makefile
# Architecture Hexagonale avec NestJS et Supabase

.PHONY: help install dev build test clean lint format setup info
.PHONY: module-users module-catalog module-cartorder module-delivery
.PHONY: module-tradein module-advisory module-backorder module-repair
.PHONY: module-rfq module-marketing

# Variables
NODE_ENV ?= development
PORT ?= 3000
APP_NAME = xeption-backend

# ğŸ¯ Aide principale
help:
	@echo "ğŸš€ Xeption Network Backend - Architecture Hexagonale"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "ğŸ“¦ Installation & Setup:"
	@echo "  make install       - Installer les dÃ©pendances"
	@echo "  make setup         - Configuration initiale complÃ¨te"
	@echo "  make info          - Informations du projet"
	@echo ""
	@echo "ğŸ”§ DÃ©veloppement:"
	@echo "  make dev           - DÃ©marrer en mode dÃ©veloppement"
	@echo "  make build         - Construire l'application"
	@echo "  make start         - DÃ©marrer en mode production"
	@echo ""
	@echo "ğŸ§ª Tests & QualitÃ©:"
	@echo "  make test          - ExÃ©cuter tous les tests"
	@echo "  make test-watch    - Tests en mode watch"
	@echo "  make test-cov      - Tests avec couverture"
	@echo "  make test-e2e      - Tests end-to-end"
	@echo "  make lint          - VÃ©rifier le code (ESLint)"
	@echo "  make format        - Formater le code (Prettier)"
	@echo ""
	@echo "ğŸ—ï¸  GÃ©nÃ©ration de Modules:"
	@echo "  make module-users      - GÃ©nÃ©rer module Users"
	@echo "  make module-catalog    - GÃ©nÃ©rer module Catalog"
	@echo "  make module-cartorder  - GÃ©nÃ©rer module CartOrder"
	@echo "  make module-delivery   - GÃ©nÃ©rer module Delivery"
	@echo "  make module-tradein    - GÃ©nÃ©rer module TradeIn"
	@echo "  make module-advisory   - GÃ©nÃ©rer module Advisory"
	@echo "  make module-backorder  - GÃ©nÃ©rer module BackOrder"
	@echo "  make module-repair     - GÃ©nÃ©rer module Repair"
	@echo "  make module-rfq        - GÃ©nÃ©rer module RFQ"
	@echo "  make module-marketing  - GÃ©nÃ©rer module Marketing"
	@echo ""
	@echo "ğŸ§¹ Maintenance:"
	@echo "  make clean         - Nettoyer les fichiers gÃ©nÃ©rÃ©s"
	@echo "  make deps-check    - VÃ©rifier les dÃ©pendances"
	@echo "  make deps-update   - Mettre Ã  jour les dÃ©pendances"

# ğŸ“¦ Installation
install:
	@echo "ğŸ“¦ Installation des dÃ©pendances NestJS..."
	npm install
	@echo "âœ… DÃ©pendances installÃ©es avec succÃ¨s"

# âš™ï¸ Configuration initiale
setup: install
	@echo "âš™ï¸  Configuration initiale du backend..."
	@echo "ğŸ“‹ VÃ©rification de la structure..."
	@ls -la src/ || echo "âŒ Dossier src/ manquant"
	@echo "ğŸ“ Configuration des variables d'environnement:"
	@echo "   1. Ã‰ditez le fichier .env"
	@echo "   2. Ajoutez vos clÃ©s Supabase"
	@echo "   3. Configurez JWT_SECRET"
	@echo "âœ… Backend configurÃ© avec architecture hexagonale"

# ğŸ”§ DÃ©veloppement
dev:
	@echo "ğŸ”§ DÃ©marrage en mode dÃ©veloppement..."
	@echo "ğŸŒ Serveur disponible sur http://localhost:$(PORT)"
	npm run start:dev

# ğŸ—ï¸ Build
build:
	@echo "ğŸ—ï¸  Construction de l'application..."
	npm run build
	@echo "âœ… Application construite dans dist/"

# ğŸš€ Production
start: build
	@echo "ğŸš€ DÃ©marrage en mode production..."
	npm run start:prod

deploy-prod:
	@echo "ğŸš€ DÃ©ploiement en production..."
	npm run deploy:prod

deploy-staging:
	@echo "ğŸš€ DÃ©ploiement en staging..."
	npm run deploy:staging

# ğŸ§ª Tests
test:
	@echo "ğŸ§ª ExÃ©cution des tests unitaires..."
	npm run test

test-watch:
	@echo "ğŸ‘€ Tests en mode watch..."
	npm run test:watch

test-cov:
	@echo "ğŸ“Š Tests avec couverture de code..."
	npm run test:cov
	@echo "ğŸ“ˆ Rapport de couverture gÃ©nÃ©rÃ© dans coverage/"

test-e2e:
	@echo "ğŸ”„ Tests end-to-end..."
	npm run test:e2e

# ğŸ” QualitÃ© du code
lint:
	@echo "ğŸ” VÃ©rification du code avec ESLint..."
	npm run lint

format:
	@echo "âœ¨ Formatage du code avec Prettier..."
	npm run format

# ğŸ—ï¸ GÃ©nÃ©ration de modules (Architecture Hexagonale)

# Module Users - Profil utilisateur enrichi + adresses
module-users:
	@echo "ğŸ‘¥ GÃ©nÃ©ration du module Users..."
	@echo "ğŸ“ Structure: domain/users + application/users + infrastructure/supabase + modules/users"
	@echo "ğŸ¯ FonctionnalitÃ©s: Profil enrichi, adresses, prÃ©fÃ©rences"
	@echo "âš ï¸  TODO: ImplÃ©menter la gÃ©nÃ©ration automatique"

# Module Catalog - Produits, specs, filtres
module-catalog:
	@echo "ğŸ“¦ GÃ©nÃ©ration du module Catalog..."
	@echo "ğŸ“ Structure: domain/catalog + application/catalog + infrastructure/supabase + modules/catalog"
	@echo "ğŸ¯ FonctionnalitÃ©s: Produits, spÃ©cifications, filtres, recherche"
	@echo "âš ï¸  TODO: ImplÃ©menter la gÃ©nÃ©ration automatique"

# Module CartOrder - Panier, commande, paiement
module-cartorder:
	@echo "ğŸ›’ GÃ©nÃ©ration du module CartOrder..."
	@echo "ğŸ“ Structure: domain/cartorder + application/cartorder + infrastructure/supabase + modules/cartorder"
	@echo "ğŸ¯ FonctionnalitÃ©s: Panier, commandes, paiement, historique"
	@echo "âš ï¸  TODO: ImplÃ©menter la gÃ©nÃ©ration automatique"

# Module Delivery - Calcul frais livraison Cameroun
module-delivery:
	@echo "ğŸšš GÃ©nÃ©ration du module Delivery..."
	@echo "ğŸ“ Structure: domain/delivery + application/delivery + infrastructure/supabase + modules/delivery"
	@echo "ğŸ¯ FonctionnalitÃ©s: Calcul frais livraison 237 (rÃ©gion, ville, commune)"
	@echo "âš ï¸  TODO: ImplÃ©menter la gÃ©nÃ©ration automatique"

# Module TradeIn - Reprise produits
module-tradein:
	@echo "ğŸ”„ GÃ©nÃ©ration du module TradeIn..."
	@echo "ğŸ“ Structure: domain/tradein + application/tradein + infrastructure/supabase + modules/tradein"
	@echo "ğŸ¯ FonctionnalitÃ©s: Demande de reprise, Ã©valuation, processus"
	@echo "âš ï¸  TODO: ImplÃ©menter la gÃ©nÃ©ration automatique"

# Module Advisory - Conseil d'achat par budget
module-advisory:
	@echo "ğŸ’¡ GÃ©nÃ©ration du module Advisory..."
	@echo "ğŸ“ Structure: domain/advisory + application/advisory + infrastructure/supabase + modules/advisory"
	@echo "ğŸ¯ FonctionnalitÃ©s: Conseil d'achat par budget, recommandations"
	@echo "âš ï¸  TODO: ImplÃ©menter la gÃ©nÃ©ration automatique"

# Module BackOrder - PrÃ©commandes
module-backorder:
	@echo "ğŸ“‹ GÃ©nÃ©ration du module BackOrder..."
	@echo "ğŸ“ Structure: domain/backorder + application/backorder + infrastructure/supabase + modules/backorder"
	@echo "ğŸ¯ FonctionnalitÃ©s: PrÃ©commande produits hors stock"
	@echo "âš ï¸  TODO: ImplÃ©menter la gÃ©nÃ©ration automatique"

# Module Repair - RÃ©parations et techniciens
module-repair:
	@echo "ğŸ”§ GÃ©nÃ©ration du module Repair..."
	@echo "ğŸ“ Structure: domain/repair + application/repair + infrastructure/supabase + modules/repair"
	@echo "ğŸ¯ FonctionnalitÃ©s: RÃ©parations, techniciens, planning"
	@echo "âš ï¸  TODO: ImplÃ©menter la gÃ©nÃ©ration automatique"

# Module RFQ - Devis entreprises
module-rfq:
	@echo "ğŸ“Š GÃ©nÃ©ration du module RFQ..."
	@echo "ğŸ“ Structure: domain/rfq + application/rfq + infrastructure/supabase + modules/rfq"
	@echo "ğŸ¯ FonctionnalitÃ©s: Devis pour entreprises, B2B"
	@echo "âš ï¸  TODO: ImplÃ©menter la gÃ©nÃ©ration automatique"

# Module Marketing - BanniÃ¨res localisÃ©es
module-marketing:
	@echo "ğŸ“¢ GÃ©nÃ©ration du module Marketing..."
	@echo "ğŸ“ Structure: domain/marketing + application/marketing + infrastructure/supabase + modules/marketing"
	@echo "ğŸ¯ FonctionnalitÃ©s: BanniÃ¨res localisÃ©es 237, campagnes"
	@echo "âš ï¸  TODO: ImplÃ©menter la gÃ©nÃ©ration automatique"

# ğŸ§¹ Maintenance
clean:
	@echo "ğŸ§¹ Nettoyage des fichiers gÃ©nÃ©rÃ©s..."
	rm -rf dist/
	rm -rf node_modules/
	rm -rf coverage/
	@echo "âœ… Nettoyage terminÃ©"

clean-cache:
	@echo "ğŸ§¹ Nettoyage du cache npm..."
	npm cache clean --force

deps-check:
	@echo "ğŸ” VÃ©rification des dÃ©pendances..."
	npm audit
	npm outdated

deps-update:
	@echo "â¬†ï¸  Mise Ã  jour des dÃ©pendances..."
	npm update

# â„¹ï¸ Informations
info:
	@echo "â„¹ï¸  Informations du projet $(APP_NAME)"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "ğŸ—ï¸  Architecture: Hexagonale (Ports & Adaptateurs)"
	@echo "ğŸš€ Framework: NestJS v11"
	@echo "ğŸ” Auth: Supabase JWT"
	@echo "ğŸ—„ï¸  Database: PostgreSQL via Supabase"
	@echo "ğŸŒ Port: $(PORT)"
	@echo "ğŸ”§ Env: $(NODE_ENV)"
	@echo ""
	@echo "ğŸ“Š Ã‰tat des modules:"
	@echo "  âœ… auth       - AuthGuard JWT + @CurrentUser() (100%)"
	@echo "  ğŸ”„ users      - Profil enrichi + adresses (0%)"
	@echo "  ğŸ”„ catalog    - Produits, specs, filtres (0%)"
	@echo "  ğŸ”„ cartorder  - Panier, commande, paiement (0%)"
	@echo "  ğŸ”„ delivery   - Calcul frais livraison 237 (0%)"
	@echo "  ğŸ”„ tradein    - Reprise produit (0%)"
	@echo "  ğŸ”„ advisory   - Conseil d'achat par budget (0%)"
	@echo "  ğŸ”„ backorder  - PrÃ©commande hors stock (0%)"
	@echo "  ğŸ”„ repair     - RÃ©paration, techniciens (0%)"
	@echo "  ğŸ”„ rfq        - Devis entreprises (0%)"
	@echo "  ğŸ”„ marketing  - BanniÃ¨res localisÃ©es 237 (0%)"
	@echo ""
	@echo "ğŸ¯ Prochaine Ã©tape: make module-users"

# ğŸ”„ Restart dev server
restart:
	@echo "ğŸ”„ RedÃ©marrage du serveur de dÃ©veloppement..."
	@pkill -f "nest start" || true
	@sleep 2
	make dev

# ğŸ“ Logs
logs:
	@echo "ğŸ“ Affichage des logs..."
	tail -f logs/*.log 2>/dev/null || echo "Aucun fichier de log trouvÃ©"

# ğŸ¯ Commande par dÃ©faut
.DEFAULT_GOAL := help